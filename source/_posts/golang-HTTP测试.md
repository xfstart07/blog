---
title: GO HTTP??
date: 2019-12-19 16:55:01
categories: Go
tags:
    - Go
    - test
---


?????????????????????????

### ??? net/http/httptest

?????? HTTP ???????

#### Server 

??`NewServer(handler http.Handler)`??????HTTP???? `Server`??????????????? `handler` ????????????????

?? `NewTLSServer` ????TLS?????

```go
func Get(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintln(w, "Hello, client")
}

func Test_Get(t *testing.T) {
    ts := httptest.NewServer(http.HandlerFunc(Get))
    defer ts.Close()
    
    res, err := http.Get(ts.URL)
    if err != nil {
    	t.Fatal(err)
    }
    greeting, err := ioutil.ReadAll(res.Body)
    res.Body.Close()
    if err != nil {
    	t.Fatal(err)
    }
}
```

#### ResponseRecorder ? NewRequest()

????? Gin ??????????? `net/http`?????? `ResponseRecorder`  ?? `NewRequest()` ????????


```go
router := gin.Default()

params := `{"code":1,"codemsg":"success"}`
w := httptest.NewRecorder()
req := httptest.NewRequest("POST", "/products", bytes.NewBuffer(params))
router.ServeHTTP(w, req)

result, _ := ioutil.ReadAll(w.Body)
t.Log("Resp Body", string(result))
if w.Code != http.StatusCreated {
	t.Errorf("????, got = %v, want = %v", w.Code, http.StatusCreated)
}
```

### ??????

??????????????????????????????????????????????????????????????????????

????

```go
import "github.com/jarcoal/httpmock"
```

???

```go
httpmock.Activate()
	defer httpmock.DeactivateAndReset()

	// our database of articles
	articles := make([]map[string]interface{}, 0)

	// mock to list out the articles
	httpmock.RegisterResponder("GET", "https://api.mybiz.com/articles",
		func(req *http.Request) (*http.Response, error) {
			resp, err := httpmock.NewJsonResponse(200, articles)
			if err != nil {
				return httpmock.NewStringResponse(500, ""), nil
			}
			return resp, nil
		},
	)
```

?????`httpmock.DeactivateAndReset()` ????????? `http.Client`???????????????? `http.Client`??????????

???????? `http.Client`????`httpmock.ActivateNonDefault(http_api.GetClient())`?

### Ref

* https://github.com/jarcoal/httpmock